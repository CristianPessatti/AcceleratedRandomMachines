---
title: "TESTE AMOSTRAGEM SVM"
output:
  html_document:
    toc: true
    df_print: paged
---

```{r setup, include=FALSE}
setwd("C:/Users/CristianPessatti/Documents/TEMP/TCC/AcceleratedRandomMachines")

knitr::opts_chunk$set(echo = FALSE, message = TRUE, warning = TRUE)

require(dplyr)
require(tidyr)
require(ggplot2)
require(arrow)
require(kernlab)
require(purrr)
require(tibble)

# Source sampling utilities
source("functions/sampling/localized_sampling.R")
source("functions/sampling/nearest_enemy_sampling.R")
source("functions/sampling/validation_samplers.R")

# utils
source("functions/utils/time_ms.R")

# Automation functions
source("functions/automation/run_benchmark.R")

# Metrics
source("functions/metrics/metrics.R")
```

```{r data}
data_linear <- arrow::read_parquet("../../datasets/linear_split.parquet")
```


## Constants

```{r constants}
n_holdouts  <- 50
train_prop  <- 0.8
sample_prop <- 0.2
base_seed   <- 123
```

## Linear Data

```{r linear_data_visualization}
set.seed(base_seed)

n_samp_lin <- max(1L, round(nrow(data_linear) * sample_prop))
lin_loc <- localized_sampling(
    data_linear,
    y_var = "y",
    final_sample_size = n_samp_lin
)
lin_ne <- nearest_enemy_sampling(
    data_linear,
    y_var = "y",
    final_sample_size = n_samp_lin,
    alpha = 3
)

ggplot(data_linear, aes(x = x1, y = x2, colour = y)) +
  geom_point(alpha = 0.7) +
  theme_minimal() +
  labs(title = "Linear Data: Original", x = "x1", y = "x2")

ggplot(lin_loc, aes(x = x1, y = x2, colour = y)) +
  geom_point(alpha = 0.9) +
  theme_minimal() +
  labs(title = "Linear Data: Localized Sampling", x = "x1", y = "x2")

ggplot(lin_ne, aes(x = x1, y = x2, colour = y)) +
  geom_point(alpha = 0.9) +
  theme_minimal() +
  labs(title = "Linear Data: Nearest Enemy Sampling", x = "x1", y = "x2")
```

```{r linear_data_run}
results_linear <- run_benchmark(
    data_linear,
    n_holdouts,
    train_prop,
    sample_prop,
    base_seed
)
```

```{r linear_data_results}
# Boxplots for Linear Data
ggplot(results_linear, aes(x = model, y = accuracy, fill = model)) +
  geom_boxplot(outlier.alpha = 0.3) +
  theme_minimal() +
  theme(legend.position = "none") +
  labs(title = "Linear Data: Accuracy by Model", x = "Model", y = "Accuracy")

ggplot(results_linear, aes(x = model, y = train_time_ms, fill = model)) +
  geom_boxplot(outlier.alpha = 0.3) +
  theme_minimal() +
  theme(legend.position = "none") +
  labs(
    title = "Linear Data: Training Time (ms) by Model",
    x = "Model",
    y = "Training time (ms)"
  )
```